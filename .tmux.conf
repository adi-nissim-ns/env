# ~/.tmux.conf - Optimized for VS Code terminal
# Mouse is DISABLED by default to prevent VS Code conflicts

# Change the prefix key from Ctrl+b to Ctrl+a (easier to reach)
#unbind C-b
#set -g prefix C-a
#bind C-a send-prefix

# Start window numbering at 1 instead of 0
set -g base-index 1
setw -g pane-base-index 1

# Enable mouse support for scrolling (VS Code compatible)
set -g mouse on

# Mouse settings optimized for VS Code terminal
set -g @scroll-speed-num-lines-per-scroll 1
set -g @scroll-speed-num-lines-per-scroll-mouse 1

# Disable default tmux right-click menu to avoid conflict with Linux menu
unbind -T root MouseDown3Pane
unbind -T root MouseDown3Status
unbind -T root MouseDown3StatusLeft

# Safe tmux shortcuts (no conflicts with Windows/Linux)
bind -n C-b send-prefix
# bind -n C-n new-window  # Conflicts with New window/document
# bind -n C-w kill-window  # Conflicts with Close tab/window
# bind -n C-r source-file ~/.tmux.conf  # Conflicts with Refresh/reload
# bind -n C-t choose-window  # Conflicts with New tab
bind -n C-u choose-session
# bind -n C-v split-window  # Conflicts with Paste
# bind -n C-h split-window -h  # Conflicts with Backspace/help
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R
bind -n C-h select-pane -L
# bind -n C-x kill-pane  # Conflicts with Cut
# bind -n C-z resize-pane -Z  # Conflicts with Undo
bind -n C-o rotate-window
# bind -n C-p previous-window  # Conflicts with Print
bind -n C-n next-window
bind -n C-1 select-window -t 1
bind -n C-2 select-window -t 2
bind -n C-3 select-window -t 3
bind -n C-4 select-window -t 4
bind -n C-5 select-window -t 5
bind -n C-6 select-window -t 6
bind -n C-7 select-window -t 7
bind -n C-8 select-window -t 8
bind -n C-9 select-window -t 9
bind -n C-0 select-window -t 0

# VS Code terminal detection and compatibility
if-shell 'test -n "$VSCODE_INJECTION" || test -n "$TERM_PROGRAM" && test "$TERM_PROGRAM" = "vscode"' {
    # VS Code specific settings
    set -g @scroll-speed-num-lines-per-scroll 1
    set -g @scroll-speed-num-lines-per-scroll-mouse 1
    set -sg escape-time 0
    set -g default-terminal "xterm-256color"
    # Enable mouse for VS Code terminal
    set -g mouse on
} {
    # Regular terminal settings
    set -g @scroll-speed-num-lines-per-scroll 3
    set -g @scroll-speed-num-lines-per-scroll-mouse 3
    set -sg escape-time 10
    set -g default-terminal "screen-256color"
    # Enable mouse for regular terminals
    set -g mouse on
}

# Make splitting windows easier and preserve the current path
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Create a new window with the current path
bind c new-window -c "#{pane_current_path}"

# Switch panes using Alt-arrow without prefix (disabled in VS Code to avoid conflicts)
# Uncomment these if you're not using VS Code or want to override VS Code shortcuts
#bind -n M-Left select-pane -L
#bind -n M-Right select-pane -R
#bind -n M-Up select-pane -U
#bind -n M-Down select-pane -D

# Alternative pane switching with Ctrl+Alt (VS Code compatible)
bind -n C-M-Left select-pane -L
bind -n C-M-Right select-pane -R
bind -n C-M-Up select-pane -U
bind -n C-M-Down select-pane -D

# Page Up/Down for scrolling (without prefix)
bind -n PageUp copy-mode -u
bind -n PageDown send-keys PageDown

# Shift+Arrow keys for easy pane scrolling
bind -n S-Up copy-mode \; send-keys -X scroll-up
bind -n S-Down send-keys -X scroll-down
bind -n S-PageUp copy-mode \; send-keys -X page-up
bind -n S-PageDown copy-mode \; send-keys -X page-down

# Enable vi mode for scrolling and copy
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# Enhanced copy mode navigation
bind-key -T copy-mode-vi 'C-u' send -X page-up
bind-key -T copy-mode-vi 'C-d' send -X page-down
bind-key -T copy-mode-vi 'C-b' send -X page-up
bind-key -T copy-mode-vi 'C-f' send -X page-down

# Increase scrollback buffer size
set -g history-limit 50000

# Dynamic status bar based on terminal type
if-shell 'test -n "$VSCODE_INJECTION" || test -n "$TERM_PROGRAM" && test "$TERM_PROGRAM" = "vscode"' {
    # VS Code status bar - show F12 shortcut
    set -g status-right '#[fg=colour233,bg=colour241,bold] %d/%m #[fg=colour233,bg=colour245,bold] %H:%M:%S #[fg=colour250,bg=colour238] VSCODE #[fg=colour51,bg=colour238] F12 '
} {
    # Regular terminal status bar - show scroll info
    set -g status-right '#{?alternate_on,#[bg=colour3]#[fg=colour0] SCROLL ,} #[fg=colour233,bg=colour241] %d/%m #[fg=colour233,bg=colour245] %H:%M:%S '
}

# Status bar styling
set -g status-position bottom
set -g status-bg colour234
set -g status-fg colour137
set -g status-left '#[fg=colour233,bg=colour245,bold] #S '
set -g status-right-length 80
set -g status-left-length 20

# Window styling
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F '
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

# Pane border styling
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour51

# Message styling
set -g message-style fg=colour232,bg=colour166,bold

# Reload config file with 'r'
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity on

# Keep windows ordered sequentially
set -g renumber-windows on

# Custom menu with session tree view and other useful commands
bind m display-menu -T "#[align=centre]#{session_name}" -x C -y C \
    "Sessions & Windows" "" "choose-tree" \
    "Rename Session (Ctrl+u)" "" "command-prompt -I '#S' 'rename-session %%'" \
    "New Window" "" "new-window" \
    "Split Horizontal" "" "split-window -v" \
    "Split Vertical" "" "split-window -h" \
    "Kill Pane" "" "kill-pane" \
    "Kill Window" "" "kill-window" \
    "Reload Config" "" "source-file ~/.tmux.conf" \
    "Cancel" "" ""

# Multiple menu shortcuts for VS Code users (since right-click doesn't work)
# Method 1: Ctrl+Shift+M (no prefix needed)
bind -n C-S-M display-menu -T "#[align=centre]#{session_name}" -x C -y C \
    "Sessions & Windows" "" "choose-tree" \
    "Rename Session (Ctrl+u)" "" "command-prompt -I '#S' 'rename-session %%'" \
    "New Window" "" "new-window" \
    "Split Horizontal" "" "split-window -v" \
    "Split Vertical" "" "split-window -h" \
    "Kill Pane" "" "kill-pane" \
    "Kill Window" "" "kill-window" \
    "Reload Config" "" "source-file ~/.tmux.conf" \
    "Cancel" "" ""

# Method 2: Ctrl+Alt+M (alternative shortcut)
bind -n C-M-M display-menu -T "#[align=centre]#{session_name}" -x C -y C \
    "Sessions & Windows" "" "choose-tree" \
    "Rename Session (Ctrl+u)" "" "command-prompt -I '#S' 'rename-session %%'" \
    "New Window" "" "new-window" \
    "Split Horizontal" "" "split-window -v" \
    "Split Vertical" "" "split-window -h" \
    "Kill Pane" "" "kill-pane" \
    "Kill Window" "" "kill-window" \
    "Reload Config" "" "source-file ~/.tmux.conf" \
    "Cancel" "" ""

# Method 3: F12 key (easy to remember)
bind -n F12 display-menu -T "#[align=centre]#{session_name}" -x C -y C \
    "Sessions & Windows" "" "choose-tree" \
    "Rename Session (Ctrl+u)" "" "command-prompt -I '#S' 'rename-session %%'" \
    "New Window" "" "new-window" \
    "Split Horizontal" "" "split-window -v" \
    "Split Vertical" "" "split-window -h" \
    "Kill Pane" "" "kill-pane" \
    "Kill Window" "" "kill-window" \
    "Reload Config" "" "source-file ~/.tmux.conf" \
    "Cancel" "" ""

# Configuration complete - mouse is enabled for both VS Code and regular terminals